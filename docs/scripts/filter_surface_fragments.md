# `filter_surface_fragments.py` Documentation

This script filters the results of the surface analysis performed by `fragment_surface_analysis.py`. It takes the combined surface analysis CSV as input and identifies fragment-frame pairs where the minimum distance between any NEC atom in the fragment and any surface Pt atom is less than or equal to a specified cutoff distance. For these qualifying fragment-frame pairs, it then selects and outputs the individual NEC atom entries that are also within the cutoff distance of a surface Pt atom.

The script generates filtered outputs in CSV, JSON, and Markdown formats.

## Usage

```bash
python filter_surface_fragments.py \\
    --input-csv /path/to/surface_analysis.csv \\
    --output-dir /path/to/output_dir \\
    [--cutoff 3.0]
```

## Arguments

*   `--input-csv` (required): Path to the combined CSV file generated by `fragment_surface_analysis.py`.
*   `--output-dir` (optional, default: `.`): Directory to save the filtered output files.
*   `--cutoff` (optional, default: `3.0`): The distance cutoff (in Ã…) used to filter fragment-frame pairs and individual atoms.

## Outputs

The script generates the following files in the specified output directory:

*   `surface_filtered.csv`: A CSV file containing rows for individual NEC atoms that are within the specified cutoff distance of a surface Pt atom, but only for fragment-frame pairs where at least one NEC atom was within the cutoff. Columns are the same as the input `surface_analysis.csv`.
*   `surface_filtered_summary.json`: A JSON file containing a list of summary dictionaries, one for each fragment-frame pair that met the minimum distance cutoff criterion. Each dictionary includes `fragment_id`, `frame_index`, the `cutoff` used, the `min_distance` for that fragment-frame, the `total_atoms` in the fragment, the number of `atoms_within_cutoff`, and `pt_classification_within_counts` (counts of nearest surface Pt atoms by classification for atoms within the cutoff).
*   `surface_filtered_summary.md`: A Markdown report summarizing the filtered results for each qualifying fragment-frame pair, presenting the information from the JSON summary in a human-readable format.