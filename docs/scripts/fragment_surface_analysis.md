# `fragment_surface_analysis.py` Documentation

This script analyzes the proximity of NEC fragments to the surface of a Platinum (Pt) nanoparticle throughout a molecular dynamics simulation. It requires the Pt atom classification data generated by `classify_pt_atoms.py` to identify surface Pt atoms. For each NEC fragment, the script calculates the minimum distance to any surface Pt atom and records the classification of that nearest Pt atom. By default, it reports only the closest NEC atom per fragment per frame, but can optionally report distances for all NEC atoms within a fragment.

The analysis can be performed on a single specified frame or across all frames of the trajectory.

## Usage

```bash
python fragment_surface_analysis.py \\
    --psf /path/to/system.psf \\
    --dcd /path/to/trajectory.dcd \\
    --pt-csv /path/to/coordination_numbers.csv \\
    [--fragment-ids 0 2 5] \\
    [--frame-index 0] \\
    --output-dir /path/to/output_dir \\
    [-v|--verbose] \\
    [--all-atoms]
```

## Arguments

*   `--psf` (required): Path to the PSF file.
*   `--dcd` (required): Path to the DCD trajectory file.
*   `--pt-csv` (required): Path to the CSV file containing Pt atom classifications (output from `classify_pt_atoms.py`).
*   `--fragment-ids` (optional): Space-separated IDs of specific fragments to analyze. If omitted, all fragments are analyzed.
*   `--frame-index` (optional): Index of a single frame to analyze. If omitted, all frames are analyzed.
*   `--output-dir` (optional, default: `.`): Directory to save output files.
*   `-v`, `--verbose` (optional, flag): Enable verbose output to the terminal.
*   `--all-atoms` (optional, flag): Save distance data for all NEC atoms within a fragment, not just the closest one.

## Outputs

The script generates the following files in the specified output directory:

*   `surface_analysis.csv`: A CSV file containing detailed distance information. Columns include `fragment_id`, `frame_index`, `atom_index` (of the NEC atom), `pt_min_distance` (distance to the nearest surface Pt atom), and `pt_classification` (classification of the nearest surface Pt atom).
*   `surface_summary.json`: A JSON file containing a list of summary dictionaries, one for each fragment-frame analyzed. Each dictionary includes `fragment_id`, `frame_index`, `n_atoms` (number of NEC atoms in the fragment), `min_distance`, `max_distance`, `mean_distance`, `median_distance`, `std_distance` (of distances to the surface Pt atoms), and `pt_classification_counts` (counts of nearest surface Pt atoms by classification).
*   `surface_summary.md`: A Markdown report summarizing the analysis for each fragment-frame, presenting the information from the JSON summary in a human-readable format.