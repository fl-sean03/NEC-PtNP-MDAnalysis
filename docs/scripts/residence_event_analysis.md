# `residence_event_analysis.py` Documentation

This script quantifies "residence events" for NEC fragments on the Platinum (Pt) nanoparticle surface. A residence event is defined as a continuous period where a fragment is within a specified spatial cutoff (based on the input filtered data) for at least a minimum duration (`min_res_time`). The script also allows for merging events separated by short off-surface gaps (`max_off_time`).

The script requires the filtered surface analysis data generated by `filter_surface_fragments.py` and the simulation metadata from `simulation_info.py`.

## Usage

```bash
python residence_event_analysis.py \\
    --filtered-csv /path/to/surface_filtered.csv \\
    --sim-info-json /path/to/simulation_info.json \\
    [--min-res-time 0.1] \\
    [--max-off-time 0.1] \\
    --output-dir /path/to/output_dir
```

## Arguments

*   `--filtered-csv` (required): Path to the `surface_filtered.csv` file generated by `filter_surface_fragments.py`.
*   `--sim-info-json` (required): Path to the `simulation_info.json` file containing simulation metadata, including time information.
*   `--min-res-time` (optional, default: `0.1`): Minimum contiguous residence time (in nanoseconds) for an event to be counted.
*   `--max-off-time` (optional, default: `0.1`): Maximum duration of an off-surface gap (in nanoseconds) that will cause adjacent residence periods to be merged into a single event.
*   `--output-dir` (optional, default: `.`): Directory to save the output files.

## Outputs

The script generates the following files in the specified output directory:

*   `residence_events.csv`: A CSV file with one row per detected residence event. Columns include `fragment_id`, `event_id`, `start_frame`, `end_frame`, `start_time_ns`, `end_time_ns`, and `duration_ns`.
*   `residence_events_summary.json`: A JSON file containing a summary for each fragment that had residence events. Each summary includes the `fragment_id`, the total number of events (`n_events`), the `total_residence_ns` (sum of all event durations for that fragment), the `mean_event_ns`, and a list of the individual `events` with their details.
*   `residence_events_summary.md`: A Markdown report summarizing the residence events and statistics for each fragment in a human-readable format.