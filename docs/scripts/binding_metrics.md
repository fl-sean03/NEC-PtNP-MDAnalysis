# `binding_metrics.py` Documentation

This script computes various binding metrics for NEC fragments interacting with the Platinum (Pt) nanoparticle surface. It utilizes the residence event data (from `residence_event_analysis.py`), the Pt atom classification data (from `classify_pt_atoms.py`), and overall simulation properties (from `simulation_info.py`) to calculate metrics such as mean residence time (`tau_mean_ns`), dissociation constant (`K_D`), and free energy of binding (`DeltaG_kJ_per_mol`).

The script provides results aggregated both per molecule (fragment) and per Pt facet type.

## Usage

```bash
python binding_metrics.py \\
    --events_csv /path/to/residence_events.csv \\
    --classification_csv /path/to/coordination_numbers.csv \\
    --properties_csv /path/to/simulation_info.csv \\
    [--output_molecule_csv molecule_results.csv] \\
    [--output_facet_csv facet_results.csv]
```

## Arguments

*   `--events_csv` (required): Path to the `residence_events.csv` file generated by `residence_event_analysis.py`.
*   `--classification_csv` (required): Path to the `coordination_numbers.csv` file generated by `classify_pt_atoms.py`.
*   `--properties_csv` (required): Path to the `simulation_info.csv` file containing simulation properties, including total simulation time.
*   `--output_molecule_csv` (optional, default: `molecule_results.csv`): Output path for the CSV file containing per-molecule binding metrics.
*   `--output_facet_csv` (optional, default: `facet_results.csv`): Output path for the CSV file containing per-facet binding metrics.

## Outputs

The script generates two CSV files:

*   `molecule_results.csv`: Contains binding metrics calculated for each individual fragment (`fragment_id`). Columns include `fragment_id`, `T_on_ns` (total residence time), `N_events` (number of residence events), `facet` (classification of the nearest Pt facet), `tau_mean_ns` (mean residence time per event), `T_off_ns` (total off-surface time), and `K_D` (dissociation constant).
*   `facet_results.csv`: Contains binding metrics averaged per Pt facet type (`facet`). Columns include `facet`, `tau_facet_ns` (mean residence time averaged over fragments on that facet), `K_D_facet` (mean dissociation constant for that facet), and `DeltaG_kJ_per_mol` (calculated free energy of binding for that facet).

## Metrics Calculation

*   `tau_mean_ns`: Mean duration of residence events per fragment.
*   `T_off_ns`: Total simulation time minus total residence time.
*   `K_D`: Calculated as `T_off_ns / T_on_ns`.
*   `DeltaG_kJ_per_mol`: Calculated using the formula `R * T * ln(K_D)`, where R is the ideal gas constant (8.314 J/(molÂ·K)) and T is the temperature (hardcoded as 453.0 K in the script). The result is converted to kJ/mol.